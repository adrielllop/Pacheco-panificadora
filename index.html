<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panificadora Pacheco</title>
    <!-- Firebase SDK (modular) via CDN -->
    <script type="module">
        // Importa√ß√µes do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot, collection, query, orderBy, setDoc, addDoc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // üî• CONFIGURA√á√ïES DO FIREBASE (fornecidas por voc√™)
        const firebaseConfig = {
            apiKey: "AIzaSyCgqSeW2h7dAZhshrTSg6Whu0zdrTH9c54",
            authDomain: "panificadora-pacheco-9beed.firebaseapp.com",
            projectId: "panificadora-pacheco-9beed",
            storageBucket: "panificadora-pacheco-9beed.firebasestorage.app",
            messagingSenderId: "806037074918",
            appId: "1:806037074918:web:9926ce237138877e185c27",
            measurementId: "G-CNVRP7995D"
        };

        // Inicializa Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Categorias dispon√≠veis
        const CATEGORIAS = ["P√£es", "Salgados", "Bolos", "Doces", "Bebidas", "Outros"];

        // Elementos da interface
        const nomeLojaEl = document.getElementById('nome-loja');
        const telefoneEl = document.getElementById('telefone');
        const enderecoEl = document.getElementById('endereco');
        const horarioEl = document.getElementById('horario');
        const adminPanel = document.getElementById('admin-panel');
        const mainView = document.getElementById('main-view');
        const passwordModal = document.getElementById('password-modal');
        const passwordInput = document.getElementById('password-input');
        const submitPassword = document.getElementById('submit-password');
        const closeModal = document.getElementById('close-modal');
        const logoutBtn = document.getElementById('logout-btn');

        // Elementos de busca e categorias
        const searchInput = document.getElementById('search-input');
        const categoriaTabs = document.getElementById('categoria-tabs');
        const produtosContainer = document.getElementById('produtos-container');

        // Formul√°rios admin
        const editTelefone = document.getElementById('edit-telefone');
        const editEndereco = document.getElementById('edit-endereco');
        const editHorario = document.getElementById('edit-horario');
        const saveConfigBtn = document.getElementById('save-config');
        const novoProdutoNome = document.getElementById('novo-produto-nome');
        const novoProdutoPreco = document.getElementById('novo-produto-preco');
        const novoProdutoCategoria = document.getElementById('novo-produto-categoria');
        const addProdutoBtn = document.getElementById('add-produto');
        const adminProdutosLista = document.getElementById('admin-produtos-lista');

        // Estado local
        let produtos = [];
        let lojaData = { telefone: '', endereco: '', horario: '' };
        let filtroCategoria = 'Todos';
        let termoBusca = '';

        // Preencher select de categorias no admin
        function preencherSelectCategoria(selectElement, categoriaSelecionada = 'P√£es') {
            selectElement.innerHTML = '';
            CATEGORIAS.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                if (cat === categoriaSelecionada) option.selected = true;
                selectElement.appendChild(option);
            });
        }
        preencherSelectCategoria(novoProdutoCategoria);

        // ------------------- LISTENERS EM TEMPO REAL -------------------
        // Escuta configura√ß√µes da loja
        const lojaRef = doc(db, "config", "loja");
        onSnapshot(lojaRef, (docSnap) => {
            if (docSnap.exists()) {
                lojaData = docSnap.data();
                telefoneEl.textContent = lojaData.telefone || '--';
                enderecoEl.textContent = lojaData.endereco || '--';
                horarioEl.textContent = lojaData.horario || '--';
                // Preenche campos admin
                editTelefone.value = lojaData.telefone || '';
                editEndereco.value = lojaData.endereco || '';
                editHorario.value = lojaData.horario || '';
            }
        });

        // Escuta produtos ordenados por nome
        const produtosQuery = query(collection(db, "produtos"), orderBy("nome"));
        onSnapshot(produtosQuery, (snapshot) => {
            produtos = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderTabs();
            renderProdutos();
            renderAdminProdutos();
        });

        // ------------------- RENDERIZA√á√ÉO DAS TABS DE CATEGORIA -------------------
        function renderTabs() {
            const categoriasExistentes = ['Todos', ...new Set(produtos.map(p => p.categoria).filter(Boolean))];
            categoriaTabs.innerHTML = '';
            categoriasExistentes.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = `tab-btn ${cat === filtroCategoria ? 'active' : ''}`;
                btn.textContent = cat;
                btn.addEventListener('click', () => {
                    filtroCategoria = cat;
                    renderTabs();
                    renderProdutos();
                });
                categoriaTabs.appendChild(btn);
            });
        }

        // ------------------- RENDERIZA√á√ÉO DOS PRODUTOS (VISITANTE) -------------------
        function renderProdutos() {
            const listaFiltrada = produtos.filter(p => {
                if (filtroCategoria !== 'Todos' && p.categoria !== filtroCategoria) return false;
                if (termoBusca && !p.nome.toLowerCase().includes(termoBusca.toLowerCase())) return false;
                return true;
            });

            produtosContainer.innerHTML = '';
            if (listaFiltrada.length === 0) {
                produtosContainer.innerHTML = '<p class="sem-produtos">Nenhum produto encontrado.</p>';
                return;
            }

            listaFiltrada.forEach(p => {
                const div = document.createElement('div');
                div.className = 'produto-card';
                div.innerHTML = `
                    <div class="produto-nome">${p.nome}</div>
                    <div class="produto-preco">R$ ${p.preco?.toFixed(2).replace('.', ',')}</div>
                    <div class="produto-categoria">${p.categoria || 'Sem categoria'}</div>
                `;
                produtosContainer.appendChild(div);
            });
        }

        // Evento de busca
        searchInput.addEventListener('input', (e) => {
            termoBusca = e.target.value;
            renderProdutos();
        });

        // ------------------- RENDERIZA√á√ÉO DOS PRODUTOS (ADMIN) -------------------
        function renderAdminProdutos() {
            adminProdutosLista.innerHTML = '';
            produtos.forEach(p => {
                const div = document.createElement('div');
                div.className = 'admin-produto';
                div.innerHTML = `
                    <input type="text" value="${p.nome}" data-id="${p.id}" class="edit-nome" placeholder="Nome">
                    <input type="number" step="0.01" value="${p.preco}" data-id="${p.id}" class="edit-preco" placeholder="Pre√ßo">
                    <select data-id="${p.id}" class="edit-categoria">
                        ${CATEGORIAS.map(cat => `<option value="${cat}" ${cat === p.categoria ? 'selected' : ''}>${cat}</option>`).join('')}
                    </select>
                    <button class="update-produto" data-id="${p.id}">Atualizar</button>
                    <button class="delete-produto" data-id="${p.id}">Excluir</button>
                `;
                adminProdutosLista.appendChild(div);
            });

            document.querySelectorAll('.update-produto').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const id = e.target.dataset.id;
                    const nomeInput = document.querySelector(`.edit-nome[data-id="${id}"]`);
                    const precoInput = document.querySelector(`.edit-preco[data-id="${id}"]`);
                    const categoriaSelect = document.querySelector(`.edit-categoria[data-id="${id}"]`);
                    await updateDoc(doc(db, "produtos", id), {
                        nome: nomeInput.value,
                        preco: parseFloat(precoInput.value),
                        categoria: categoriaSelect.value
                    });
                });
            });

            document.querySelectorAll('.delete-produto').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const id = e.target.dataset.id;
                    await deleteDoc(doc(db, "produtos", id));
                });
            });
        }

        // ------------------- TRIPLO CLIQUE NO NOME -------------------
        let clickCount = 0;
        let clickTimer;
        nomeLojaEl.addEventListener('click', () => {
            clickCount++;
            if (clickCount === 1) {
                clickTimer = setTimeout(() => { clickCount = 0; }, 2000);
            } else if (clickCount === 3) {
                clearTimeout(clickTimer);
                clickCount = 0;
                passwordModal.style.display = 'flex';
                passwordInput.value = '';
            }
        });

        closeModal.addEventListener('click', () => {
            passwordModal.style.display = 'none';
        });

        submitPassword.addEventListener('click', () => {
            if (passwordInput.value === 'Pacheco2025') {
                passwordModal.style.display = 'none';
                mainView.style.display = 'none';
                adminPanel.style.display = 'block';
            } else {
                alert('Senha incorreta!');
            }
        });

        logoutBtn.addEventListener('click', () => {
            adminPanel.style.display = 'none';
            mainView.style.display = 'block';
        });

        // ------------------- SALVAR CONFIGURA√á√ïES DA LOJA -------------------
        saveConfigBtn.addEventListener('click', async () => {
            await setDoc(lojaRef, {
                telefone: editTelefone.value,
                endereco: editEndereco.value,
                horario: editHorario.value
            });
        });

        // ------------------- ADICIONAR NOVO PRODUTO -------------------
        addProdutoBtn.addEventListener('click', async () => {
            const nome = novoProdutoNome.value.trim();
            const preco = parseFloat(novoProdutoPreco.value);
            const categoria = novoProdutoCategoria.value;
            if (nome && !isNaN(preco)) {
                await addDoc(collection(db, "produtos"), {
                    nome,
                    preco,
                    categoria
                });
                novoProdutoNome.value = '';
                novoProdutoPreco.value = '';
            } else {
                alert('Preencha nome e pre√ßo v√°lido.');
            }
        });

        // ------------------- ESTILOS (MELHORADOS) -------------------
        const style = document.createElement('style');
        style.textContent = `
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: #f8f1e0;
                color: #3e2a1f;
                line-height: 1.6;
            }
            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
            }
            h1 {
                text-align: center;
                font-size: 3rem;
                color: #b95b2d;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
                cursor: pointer;
                margin-bottom: 20px;
                font-family: 'Georgia', serif;
            }
            .info-box {
                background: #fff5e6;
                border-radius: 15px;
                padding: 25px;
                margin: 20px 0;
                box-shadow: 0 8px 16px rgba(0,0,0,0.1);
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
            }
            .info-item {
                display: flex;
                align-items: center;
                gap: 10px;
                font-size: 1.1rem;
            }
            .info-item i {
                font-size: 1.5rem;
                color: #b95b2d;
                width: 30px;
            }
            .search-bar {
                margin: 20px 0;
                display: flex;
                justify-content: center;
            }
            #search-input {
                width: 100%;
                max-width: 500px;
                padding: 12px 20px;
                border: 2px solid #d4a373;
                border-radius: 30px;
                font-size: 1rem;
                outline: none;
                transition: 0.3s;
            }
            #search-input:focus {
                border-color: #b95b2d;
                box-shadow: 0 0 10px rgba(185,91,45,0.3);
            }
            .tabs-container {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                margin: 20px 0;
                justify-content: center;
            }
            .tab-btn {
                padding: 10px 20px;
                background: #e7d4b5;
                border: none;
                border-radius: 25px;
                font-size: 1rem;
                cursor: pointer;
                transition: 0.3s;
                color: #5c3e2e;
                font-weight: 600;
            }
            .tab-btn.active {
                background: #b95b2d;
                color: white;
                box-shadow: 0 4px 8px rgba(185,91,45,0.3);
            }
            .tab-btn:hover {
                background: #c97c54;
                color: white;
            }
            .produtos-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 20px;
                margin-top: 20px;
            }
            .produto-card {
                background: white;
                border-radius: 12px;
                padding: 20px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.08);
                transition: transform 0.2s, box-shadow 0.2s;
                border-left: 5px solid #b95b2d;
                display: flex;
                flex-direction: column;
            }
            .produto-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 12px 24px rgba(0,0,0,0.15);
            }
            .produto-nome {
                font-size: 1.4rem;
                font-weight: bold;
                color: #3e2a1f;
                margin-bottom: 10px;
            }
            .produto-preco {
                font-size: 2rem;
                color: #b95b2d;
                font-weight: bold;
                margin-bottom: 5px;
            }
            .produto-categoria {
                background: #f0e0c0;
                padding: 5px 10px;
                border-radius: 20px;
                display: inline-block;
                align-self: flex-start;
                font-size: 0.9rem;
                color: #5c3e2e;
            }
            .sem-produtos {
                text-align: center;
                font-size: 1.2rem;
                color: #999;
                grid-column: 1 / -1;
                padding: 40px;
            }
            #admin-panel {
                background: #f4e9d8;
                padding: 30px;
                border-radius: 20px;
                margin-top: 20px;
            }
            .admin-section {
                background: white;
                border-radius: 15px;
                padding: 20px;
                margin: 20px 0;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }
            .admin-section h3 {
                color: #b95b2d;
                margin-bottom: 15px;
                border-bottom: 2px solid #e7d4b5;
                padding-bottom: 5px;
            }
            input, select, button {
                padding: 10px 15px;
                margin: 5px;
                border: 1px solid #d4a373;
                border-radius: 8px;
                font-size: 1rem;
            }
            button {
                background: #b95b2d;
                color: white;
                border: none;
                cursor: pointer;
                transition: 0.3s;
                font-weight: 600;
            }
            button:hover {
                background: #9f4a23;
            }
            #logout-btn {
                background: #6c757d;
            }
            #logout-btn:hover {
                background: #5a6268;
            }
            .admin-produto {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                align-items: center;
                background: #faf3e9;
                padding: 15px;
                border-radius: 8px;
                margin: 10px 0;
            }
            .admin-produto input, .admin-produto select {
                flex: 1 1 150px;
            }
            #password-modal {
                display: none;
                position: fixed;
                top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.5);
                justify-content: center;
                align-items: center;
                z-index: 1000;
            }
            .modal-content {
                background: white;
                padding: 30px;
                border-radius: 15px;
                text-align: center;
                max-width: 400px;
                width: 90%;
            }
            .modal-content h3 {
                color: #b95b2d;
                margin-bottom: 20px;
            }
            .modal-content input {
                width: 100%;
                margin-bottom: 15px;
            }
            @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css');
        `;
        document.head.appendChild(style);

        // Adicionar link do Font Awesome
        const faLink = document.createElement('link');
        faLink.rel = 'stylesheet';
        faLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css';
        document.head.appendChild(faLink);
    </script>
</head>
<body>
    <div class="container">
        <div id="main-view">
            <h1 id="nome-loja">Pacheco Panificadora</h1>
            
            <div class="info-box">
                <div class="info-item"><i class="fas fa-phone-alt"></i> <span id="telefone"></span></div>
                <div class="info-item"><i class="fas fa-map-marker-alt"></i> <span id="endereco"></span></div>
                <div class="info-item"><i class="fas fa-clock"></i> <span id="horario"></span></div>
            </div>

            <div class="search-bar">
                <input type="text" id="search-input" placeholder="üîç Buscar produtos...">
            </div>

            <div id="categoria-tabs" class="tabs-container">
                <!-- Tabs ser√£o geradas dinamicamente -->
            </div>

            <div id="produtos-container" class="produtos-grid">
                <!-- Produtos ser√£o inseridos aqui -->
            </div>
        </div>

        <div id="admin-panel" style="display: none;">
            <h2>üßë‚Äçüç≥ Painel Administrativo</h2>
            
            <div class="admin-section">
                <h3>üìã Dados da Loja</h3>
                <p><i class="fas fa-phone-alt"></i> Telefone: <input type="text" id="edit-telefone" placeholder="(11) 99999-9999"></p>
                <p><i class="fas fa-map-marker-alt"></i> Endere√ßo: <input type="text" id="edit-endereco" placeholder="Rua Exemplo, 123"></p>
                <p><i class="fas fa-clock"></i> Hor√°rio: <input type="text" id="edit-horario" placeholder="Seg-Sex: 6h-20h"></p>
                <button id="save-config">Salvar Altera√ß√µes</button>
            </div>

            <div class="admin-section">
                <h3>‚ûï Adicionar Produto</h3>
                <input type="text" id="novo-produto-nome" placeholder="Nome do produto">
                <input type="number" id="novo-produto-preco" placeholder="Pre√ßo (R$)" step="0.01">
                <select id="novo-produto-categoria"></select>
                <button id="add-produto">Adicionar</button>
            </div>

            <div class="admin-section">
                <h3>‚úèÔ∏è Editar/Excluir Produtos</h3>
                <div id="admin-produtos-lista"></div>
            </div>

            <button id="logout-btn">üö™ Sair do Painel</button>
        </div>
    </div>

    <div id="password-modal">
        <div class="modal-content">
            <h3>üîí √Årea Restrita</h3>
            <input type="password" id="password-input" placeholder="Digite a senha">
            <button id="submit-password">Entrar</button>
            <button id="close-modal">Cancelar</button>
        </div>
    </div>
</body>
</html>